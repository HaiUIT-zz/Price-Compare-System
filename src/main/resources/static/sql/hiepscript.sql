INSERT INTO agents (code, name, search_url, is_deleted)
VALUES ('vta', 'Viễn Thông A', 'https://vienthonga.vn/tim-kiem?q=bla', FALSE);

INSERT INTO products (name, image, visit_count, rating, agent_count)
VALUES ('iPhone 8 256GB', 'https://i.imgur.com/ytLAXGy.jpg', 0, 0, 0);
INSERT INTO products (name, image, visit_count, rating, agent_count)
VALUES ('iPhone 8 Plus 256GB', 'https://i.imgur.com/FbYfps1.png', 0, 0, 0);
INSERT INTO products (name, image, visit_count, rating, agent_count)
VALUES ('iPhone 7 256GB ', 'https://i.imgur.com/OKV23bg.png', 0, 0, 0);
INSERT INTO products (name, image, visit_count, rating, agent_count)
VALUES ('iPhone 7 Plus 256GB ', 'https://i.imgur.com/carkG1B.jpg', 0, 0, 0);
INSERT INTO products (name, image, visit_count, rating, agent_count)
VALUES ('iPhone 6s 128GB ', 'https://i.imgur.com/LhR1brv.png', 0, 0, 0);
INSERT INTO products (name, image, visit_count, rating, agent_count)
VALUES ('iPhone 6s Plus 128GB ', 'https://i.imgur.com/LhR1brv.png', 0, 0, 0);
INSERT INTO products (name, image, visit_count, rating, agent_count)
VALUES ('iPhone 6 128GB ', 'https://i.imgur.com/LhR1brv.png', 0, 0, 0);
INSERT INTO products (name, image, visit_count, rating, agent_count)
VALUES ('iPhone 6 Plus 128GB ', 'https://i.imgur.com/LhR1brv.png', 0, 0, 0);

INSERT INTO products (name, image, visit_count, rating, agent_count)
VALUES ('iPhone 8 256GB', 'https://i.imgur.com/ytLAXGy.jpg', 0, 0, 0);
INSERT INTO products (name, image, visit_count, rating, agent_count)
VALUES ('iPhone 8 Plus 256GB', 'https://i.imgur.com/FbYfps1.png', 0, 0, 0);
INSERT INTO products (name, image, visit_count, rating, agent_count)
VALUES ('iPhone 7 256GB ', 'https://i.imgur.com/OKV23bg.png', 0, 0, 0);
INSERT INTO products (name, image, visit_count, rating, agent_count)
VALUES ('iPhone 7 Plus 256GB ', 'https://i.imgur.com/carkG1B.jpg', 0, 0, 0);
INSERT INTO products (name, image, visit_count, rating, agent_count)
VALUES ('iPhone 6s 128GB ', 'https://i.imgur.com/LhR1brv.png', 0, 0, 0);
INSERT INTO products (name, image, visit_count, rating, agent_count)
VALUES ('iPhone 6s Plus 128GB ', 'https://i.imgur.com/LhR1brv.png', 0, 0, 0);
INSERT INTO products (name, image, visit_count, rating, agent_count)
VALUES ('iPhone 6 128GB ', 'https://i.imgur.com/LhR1brv.png', 0, 0, 0);
INSERT INTO products (name, image, visit_count, rating, agent_count)
VALUES ('iPhone 6 Plus 128GB ', 'https://i.imgur.com/LhR1brv.png', 0, 0, 0);

INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (23, 1, 200000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (24, 1, 220000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (25, 1, 190000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (26, 1, 210000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (27, 1, 180000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (28, 1, 200000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (29, 1, 170000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (30, 1, 190000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');

INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (23, 2, 220000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (24, 2, 240000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (25, 2, 210000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (26, 2, 230000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (27, 2, 200000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (28, 2, 220000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (29, 2, 190000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (30, 2, 210000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');

INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (23, 3, 180000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (24, 3, 200000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (25, 3, 170000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (26, 3, 190000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (27, 3, 160000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (28, 3, 180000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (29, 3, 150000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (30, 3, 190000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');

INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (23, 4, 250000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (24, 4, 270000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (25, 4, 240000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (26, 4, 260000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (27, 4, 230000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (28, 4, 250000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (29, 4, 220000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (30, 4, 240000000, 'https://www.thegioididong.com/dtdd/iphone-8-plus-256gb');

--create voting table to manage voting of user
CREATE TABLE VOTING (
  id         SERIAL PRIMARY KEY,
  email      VARCHAR(1000),
  product_id INT REFERENCES products (id),
  rating     INTEGER,
  date
);

DROP TABLE VOTING;

INSERT INTO VOTING (email, product_id, rating) VALUES ('user1@gmail.com', 23, 1);

UPDATE products
SET agent_count = 1
WHERE id = 7;


SELECT CASE WHEN email = 'frrfttt'
  THEN TRUE
       ELSE FALSE END
FROM voting
WHERE product_id = 29 AND email = 'frrfttt'


INSERT INTO products (name, image, visit_count, rating, agent_count, rating_count, type)
VALUES ('Dell Inspiron 3467', 'https://i.imgur.com/C9jV7WR.png', 0, 0, 0, 0, 'laptop');
INSERT INTO products (name, image, visit_count, rating, agent_count, rating_count, type)
VALUES ('Dell Vostro 3468', 'https://i.imgur.com/kJfJSZD.png', 0, 0, 0, 0, 'laptop');
INSERT INTO products (name, image, visit_count, rating, agent_count, rating_count, type)
VALUES ('Dell Inspiron 5468', 'https://i.imgur.com/SjL3Q3q.jpg', 0, 0, 0, 0, 'laptop');
INSERT INTO products (name, image, visit_count, rating, agent_count, rating_count, type)
VALUES ('Dell Inspiron 5567', 'https://i.imgur.com/v8ZdQjv.png', 0, 0, 0, 0, 'laptop');

INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (159, 1, 11290000, 'https://www.thegioididong.com/laptop/dell-inspiron-3467-i3-7100u-m20nr21');
INSERT INTO products_agents (product_id, agent_id, price, url)
VALUES (159, 1, 11290000, 'https://fptshop.com.vn/may-tinh-xach-tay/dell-n3467');

SELECT *
FROM products
WHERE type LIKE 'laptop';


SELECT CASE WHEN email = 'wefw1e'
  THEN TRUE
       ELSE FALSE END
FROM voting
WHERE product_id = 25 AND email = 'wefw1e';

UPDATE products
SET rating = (SELECT (SELECT SUM(rating)
                      FROM VOTING
                      WHERE product_id = 23) / (SELECT COUNT(*)
                                                FROM VOTING
                                                WHERE product_id = 23))
WHERE products.id = 23;

SELECT
  p.id,
  p.name,
  p.image,
  p.visit_count,
  p.rating,
  p.agent_count,
  p.rating_count,
  p.type
FROM products p INNER JOIN products_agents pa ON p.id = pa.product_id
WHERE (:location IS NULL OR :location ILIKE pa.location) AND
      ((:from IS NULL OR :to IS NULL) OR pa.price BETWEEN :from AND :to) AND
      (:keyword IS NULL OR p.name ILIKE '%' || :keyword || '%');


SELECT COUNT(*)
FROM products
